#!/bin/bash

source "/opt/pmp/functions.sh"

#TODO usage

PORT=$(($RANDOM+3000))
echo $1
filename=$(basename $1)
TMPDIR=$(mktemp -d)
BACK=`dirname $0`

echo $BACK
#exit
echo "exited,?"
#hide_guake
#switchTmuxDOWN

#cp $1 $TMPDIR
#terminator --working-directory=$TMPDIR -e \
#cd $TMPDIR
nohup python3 -m http.server $PORT & PID=$! 
sleep 1
switchTmuxDOWN
command "wget http://$IP:$PORT/$filename -O /dev/shm/$filename"

switchTmuxUP

#alt_tab
#ctrl C
echo "$PID kill"
kill -9 $PID
#cd $BACK
